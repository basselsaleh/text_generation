<!DOCTYPE html>
<html>
    <head>
        <title> CatGPT </title>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>

    <body>
        <h1> Welcome to CatGPT </h1>
        A simple and silly Markov-chain based chat bot, created by Bassel Saleh.<br>
        <a href="https://climbingthegiant.com/posts/catGPT/">Click here for more info</a>

        <div class="chat-container">
            <div class="chat" id="chat">
                <div class="message from-catgpt">
                    Hello thâ€” I mean... meow. My name is CatGPT. What can I help you with today?
                </div>
            </div>
            <div class="message user-input">
                <form>
                    <label for="input_text"></label>
                    <input type="text" id="input_text" name="input_text">
                    <!-- <button type="button" onclick="getResponse()" id="submit"></button> -->
                </form>
            </div>
        </div>

        <script>
            var input = document.getElementById("input_text");
            input.addEventListener("keypress", function(event) {
                if(event.key === "Enter") {
                    event.preventDefault();
                    // document.getElementById("submit").click();
                    getResponse();
                    input.value = "";
                }
            })

            function getResponse() {
                const inputText = document.getElementById("input_text").value;
                addMessage("user", inputText);

                fetch("http://localhost:6969/generate-response", {
                    method: "POST",
                    body: inputText
                })
                .then(response => response.text())
                .then(data => {
                    // document.getElementById("response_text").innerHTML = data;
                    addMessage("catgpt", data);
                });
            }

            function addMessage(from, text) {
                var messageDiv = document.createElement("div");
                messageDiv.className = "message " + (from === "user" ? "from-user" : "from-catgpt");
                messageDiv.innerHTML = text;
                var chatDiv = document.getElementById("chat");
                // chatDiv.appendChild(messageDiv);
                chatDiv.insertBefore(messageDiv, chatDiv.firstChild)
            }
        </script>
    </body>
</html>